<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASPD Collaborative Pay Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="style.css"> 
</head>
<body class="p-4 sm:p-8 min-h-screen" onclick="closeRankChangeModal(event)">
    
    <div id="securityGate" class="modal-overlay fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-sm border-t-4 border-yellow-500 p-6 text-center space-y-4">
            <i class="fa-solid fa-shield-halved text-yellow-500 text-4xl"></i>
            <h2 class="text-xl font-bold text-white uppercase">Admin Authorization</h2>
            <p class="text-xs text-gray-400">Enter the 4-digit master code to perform this action.</p>
            <input type="password" id="gateKey" placeholder="••••" class="w-full p-4 rounded-lg bg-gray-900 border border-gray-700 text-center text-2xl tracking-[1rem] font-bold text-white focus:border-yellow-500 outline-none">
            <div class="flex gap-2">
                <button onclick="verifySecurityGate()" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 rounded-lg transition uppercase text-xs">Authorize</button>
                <button onclick="closeSecurityGate()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg transition uppercase text-xs">Cancel</button>
            </div>
        </div>
    </div>

    <div id="loadingOverlay" class="fixed inset-0 z-[60] flex items-center justify-center bg-gray-900 transition-opacity duration-500">
        <div class="text-center">
            <i class="fa-solid fa-sync fa-spin fa-2x text-indigo-400"></i>
            <p class="mt-4 text-xl font-semibold text-gray-300">Syncing Mainframe Data...</p>
        </div>
    </div>

    <div class="max-w-7xl mx-auto space-y-8">
        <header class="text-center pb-4 border-b border-gray-700">
            <h1 class="text-3xl sm:text-4xl font-bold text-yellow-400 tracking-tight uppercase italic">ASPD Payroll Tracker</h1>
            <div id="authStatus" class="mt-3 text-sm text-gray-500 flex flex-col items-center justify-center space-y-1">
                <div class="flex items-center space-x-2">
                    <i id="connectionIcon" class="fa-solid fa-circle-check text-green-500 animate-pulse"></i>
                    <span id="connectionText" class="uppercase font-mono text-[10px] tracking-widest text-green-500">Uplink Active // Encrypted Data Stream</span>
                </div>
                <div class="data-stream-container w-48">
                    <div id="dataStreamLine" class="data-stream-line data-stream-connected"></div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6">
            <div class="card text-center border-t-4 border-indigo-500 sm:col-span-2">
                <h2 class="text-sm font-semibold text-gray-300 uppercase tracking-wide flex items-center justify-center mb-2">
                     <i class="fa-solid fa-building-columns mr-2 text-indigo-500"></i> Total Department Fund (Employee Liability)
                </h2>
                <p id="shortfallFundAmount" class="font-extrabold text-3xl text-red-400 transition-all duration-500">0.00</p>
            </div>
            <div class="card text-center border-t-4 border-blue-500">
                <h2 class="text-sm font-semibold text-gray-300 uppercase tracking-wide flex items-center justify-center mb-2">
                    <i class="fa-solid fa-calculator mr-2 text-blue-500"></i> Payments Logged
                </h2>
                <p id="paymentCount" class="font-extrabold text-3xl text-gray-200 transition-all duration-500">0</p>
            </div>
            <div class="card text-center border-t-4 border-green-500">
                <h2 class="text-sm font-semibold text-gray-300 uppercase tracking-wide flex items-center justify-center mb-2">
                    <i class="fa-solid fa-user-plus mr-2 text-green-500"></i> New Hires
                </h2>
                <p id="newHireCount" class="font-extrabold text-3xl text-green-400 transition-all duration-500">0</p>
            </div>
            <div class="card text-center border-t-4 border-red-500">
                <h2 class="text-sm font-semibold text-gray-300 uppercase tracking-wide flex items-center justify-center mb-2">
                    <i class="fa-solid fa-user-minus mr-2 text-red-500"></i> Terminations
                </h2>
                <p id="terminationCount" class="font-extrabold text-3xl text-red-400 transition-all duration-500">0</p>
            </div>
            <div class="card flex flex-col justify-center space-y-2 border-t-4 border-gray-500 lg:col-span-1 lg:row-start-2 lg:row-end-3">
                 <button onclick="window.softRefreshApp()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition text-xs flex items-center justify-center"><i class="fa-solid fa-sync mr-1"></i> Refresh</button>
                 <button onclick="window.openReadmeModal()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded-lg transition text-xs flex items-center justify-center"><i class="fa-solid fa-book-open mr-1"></i> Logic</button>
                 <button onclick="secureRequest('factory')" class="w-full bg-red-700 hover:bg-red-800 text-white font-bold py-2 rounded-lg transition text-xs flex items-center justify-center"><i class="fa-solid fa-trash-can mr-1"></i> Reset</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="card border-l-4 border-yellow-500 lg:col-span-1 h-fit">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center"><i class="fa-solid fa-hand-holding-dollar mr-2 text-yellow-500"></i> Log Payment Status</h3>
                <div class="space-y-4">
                    <select id="transactionEmployeeId" onchange="window.updateExpectedPayForTransaction()" class="w-full p-3 rounded-lg"><option value="" disabled selected>-- Select Employee --</option></select>
                    <input type="text" id="expectedPay" value="0.00" readonly class="w-full p-3 rounded-lg bg-gray-800 text-yellow-400 font-bold text-lg cursor-not-allowed border-gray-700">
                    <p id="accrualDetails" class="text-xs text-gray-400">Accrual Weeks: 0.00 | Weekly Accrual: 0.00</p>
                    <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                        <label class="text-lg font-bold text-green-300">Paid Full Amount</label>
                        <label class="toggle-switch"><input type="checkbox" id="checkFullPay" onchange="window.toggleActualPayInput()"><span class="toggle-switch-label"></span></label>
                    </div>
                    <div id="actualPayContainer">
                        <input type="text" id="actualPay" oninput="window.formatInputCurrency(this)" class="w-full p-4 rounded-lg text-xl font-bold text-white border-yellow-500">
                    </div>
                    <button id="logPayStatusButton" onclick="secureRequest('pay')" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 rounded-lg transition text-lg" disabled>Log Transaction</button>
                    <p id="currentLogStatus" class="text-center text-[10px] text-yellow-200/50 italic uppercase">Authorization Required to Execute</p>
                </div>
            </div>

            <div class="card lg:col-span-2 border-l-4 border-purple-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-white flex items-center"><i class="fa-solid fa-sheet-plastic mr-2 text-purple-400"></i> Active Roster</h3>
                    <button onclick="secureRequest('add')" class="bg-purple-600 hover:bg-purple-700 text-white font-bold p-3 rounded-xl transition text-sm flex items-center shadow-md"><i class="fa-solid fa-user-plus mr-1"></i> Add Personnel</button>
                </div>
                <div id="payrollSheetDesktop" class="hidden lg:block overflow-x-auto"><div class="payroll-row-desktop payroll-header"><div>ID</div><div>Name</div><div>Rank</div><div class="text-right">Monthly</div><div class="text-right">Wk Accrual</div><div class="text-right">Last Pay</div><div class="text-center">Status</div><div>Actions</div></div><div id="payrollSheetBodyDesktop" class="space-y-1"></div></div>
                <div id="payrollSheetMobile" class="lg:hidden space-y-3"></div>
            </div>
        </div>

        <div class="card">
            <h3 class="text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2">Audit History</h3>
            <div id="historyBody" class="min-w-full text-sm"></div>
        </div>
    </div>

    <div id="rankChangeModal" class="rank-popover-menu hidden"></div>
    <div id="errorBox" class="fixed bottom-5 right-5 hidden max-w-sm z-50 transition-opacity duration-300 text-sm font-semibold p-3 rounded-lg shadow-xl"></div>
    <script src="script.js"></script>
</body>
</html>
